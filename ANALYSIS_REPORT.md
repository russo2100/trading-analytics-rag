# üìä –ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã: Trading Analytics RAG System
## –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: 2026-02-06

---

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ **production-grade RAG (Retrieval-Augmented Generation) —Å–∏—Å—Ç–µ–º–∞** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤–ª–∏ –ø—Ä–∏—Ä–æ–¥–Ω—ã–º –≥–∞–∑–æ–º. –ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ LLMOps: –º–Ω–æ–≥–æ–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ü–µ–Ω–∫–∏ –∏ –∞–≥–µ–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã.

### –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞:
- ‚úÖ **Multi-source Knowledge Base**: –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞ (JSONL), —Ä—ã–Ω–æ—á–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ (PDF), –Ω–æ–≤–æ—Å—Ç–µ–π (TXT/MD)
- ‚úÖ **Hybrid Retrieval**: BM25 + dense embeddings + reranking –¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
- üöß **Production-ready**: FastAPI —Å–µ—Ä–≤–∏—Å, Docker Compose, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚è≥ **Measurable Quality**: –ù–∞–±–æ—Ä –∑–æ–ª–æ—Ç—ã—Ö Q/A –¥–∞–Ω–Ω—ã—Ö, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
- ‚úÖ **Portfolio Value**: –ß–∏—Å—Ç—ã–π –∫–æ–¥, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

---

## üìà –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –§–∞–∑–∞ 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç (–ó–ê–í–ï–†–®–ï–ù–ê)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|-----------|:------:|--------|
| **–°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö** | ‚úÖ | SQLite: `trading_events`, `sessions`, `trades`, `broker_trades`, `events` |
| **Pipeline –∑–∞–≥—Ä—É–∑–∫–∏** | ‚úÖ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (JSONL v1/v2, PDF, TXT) |
| **–ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö** | ‚úÖ | 1,041 —Å–æ–±—ã—Ç–∏–π, 26 —Å–¥–µ–ª–æ–∫, 0 NULL/–¥—É–±–ª–∏–∫–∞—Ç–æ–≤ |
| **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** | ‚úÖ | –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ event IDs, –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ |

**–î–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ:**
- **trading_events**: 1,041 –∑–∞–ø–∏—Å–µ–π (–ª–æ–≥–∏ —Ä–µ—à–µ–Ω–∏–π –±–æ—Ç–∞)
- **sessions**: 2 —Å–µ—Å—Å–∏–∏ (2026-01-29, 2026-01-30)
- **trades**: 26 —Å–¥–µ–ª–æ–∫ (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–∑ action)
- **events**: 0 –∑–∞–ø–∏—Å–µ–π (RAG —Å–æ–±—ã—Ç–∏—è - –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã)

### üöß –§–∞–∑–∞ 2: Retrieval (–í –ü–†–û–¶–ï–°–°–ï)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|-----------|:------:|--------|
| **Vector Store** | ‚úÖ | FAISS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ |
| **Hybrid Search** | üöß | BM25 + dense retrieval (–∫–æ–¥ –≥–æ—Ç–æ–≤) |
| **Reranking** | ‚è≥ | Cross-encoder –¥–ª—è —Ç–æ–ø-K —É—Ç–æ—á–Ω–µ–Ω–∏—è |
| **Evaluation** | ‚è≥ | –ó–æ–ª–æ—Ç–æ–π Q/A –¥–∞—Ç–∞—Å–µ—Ç + –º–µ—Ç—Ä–∏–∫–∏ |

**–í–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å:**
- ‚ùå –ò–Ω–¥–µ–∫—Å –µ—â–µ –Ω–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `data/vector_index` –ø—É—Å—Ç–∞)
- ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤: `VectorStore` –∫–ª–∞—Å—Å —Å FAISS
- ‚úÖ –°–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤: `scripts/build_vector_index.py`
- ‚úÖ –¢–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã: `tests/unit/test_vector_store.py` (263 —Å—Ç—Ä–æ–∫–∏)

### ‚è≥ –§–∞–∑—ã 3-5: –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã

- **–§–∞–∑–∞ 3**: Generation (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è LLM, prompt engineering, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ü–∏—Ç–∞—Ç)
- **–§–∞–∑–∞ 4**: Agents (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á, –º–Ω–æ–≥–æ—à–∞–≥–æ–≤–æ–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ, –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
- **–§–∞–∑–∞ 5**: Production (FastAPI, Docker, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, CI/CD)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ **—Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

```
Layer 1: Ingestion  ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
Layer 2: Storage    ‚Üí SQLite (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ) + FAISS (–≤–µ–∫—Ç–æ—Ä—ã)
Layer 3: Retrieval  ‚Üí –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (BM25 + dense)
Layer 4: Generation ‚Üí LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (OpenRouter)
Layer 5: Agents     ‚Üí –ê–≥–µ–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
```

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### **Layer 1: Ingestion** ‚úÖ
- `loaders.py` - –ü–∞—Ä—Å–µ—Ä—ã –¥–ª—è JSONL, PDF, TXT
- `normalizers.py` - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ v1/v2
- `deduplication.py` - –õ–æ–≥–∏–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
- `models.py` - Pydantic –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- `id_generators.py` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö ID

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–¥–µ–ª–∏:**
```python
class IngestedEvent(BaseModel):
    event_id: str          # MD5 hash (source + timestamp + canonical_form)
    source: str            # 'logs', 'eia', 'weather', 'news'
    canonical_form: dict   # –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
    embedding_text: str    # –¢–µ–∫—Å—Ç –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
    metadata: dict         # authority, freshness, data_period
```

#### **Layer 2: Storage** ‚úÖ
- `metadata_store.py` - SQLite –∫–ª–∏–µ–Ω—Ç —Å FTS5
- `vector_store.py` - FAISS –æ–±–µ—Ä—Ç–∫–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- `schema.sql` - –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (271 —Å—Ç—Ä–æ–∫–∞)
- `embed.py` - Pipeline —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- `cache.py` - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ VectorStore:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (L2 distance ‚Üí similarity score)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPU (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ (100+ —Å–æ–±—ã—Ç–∏–π)

**–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- RAG —Ç–∞–±–ª–∏—Ü—ã
events              -- IngestedEvent –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
events_fts          -- Full-text search –∏–Ω–¥–µ–∫—Å (FTS5)
query_stats         -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

-- Trading —Ç–∞–±–ª–∏—Ü—ã
trading_events      -- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –±–æ—Ç–∞ (–∫–∞–∂–¥—ã–π —Ü–∏–∫–ª)
sessions            -- –¢–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–Ω—è–º)
trades              -- –ò—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏
broker_trades       -- –ò–º–ø–æ—Ä—Ç –∏–∑ PDF –æ—Ç—á–µ—Ç–æ–≤
daily_pnl           -- –î–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ P&L
```

#### **Layer 3: Retrieval** üöß
- `hybrid_search.py` - BM25 + dense fusion (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- `query_router.py` - –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- `reranker.py` - Cross-encoder reranking (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

---

## üìù –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥

### 1. **VectorStore** (`src/layer2_storage/vector_store.py`) - 290 —Å—Ç—Ä–æ–∫

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
```python
class VectorStore:
    def __init__(self, embedding_model=None, use_gpu=False)
    def add_events(event_ids, texts, metadata)
    def search(query, top_k=10, filter_metadata=None)
    def get_by_id(event_id)
    def save(index_path)
    def load(index_path)
    def clear()
    def get_stats()
```

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: `sentence-transformers/all-MiniLM-L6-v2` (384 dim)
- FAISS –∏–Ω–¥–µ–∫—Å: `IndexFlatL2` (—Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: L2 distance ‚Üí similarity score (0-1)
- Batch encoding: 32 —Å–æ–±—ã—Ç–∏—è –∑–∞ —Ä–∞–∑
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: FAISS index + event_ids (pickle) + metadata (JSON)

### 2. **Unit Tests** (`tests/unit/test_vector_store.py`) - 263 —Å—Ç—Ä–æ–∫–∏

**–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:**
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π (—Å/–±–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –ü–æ–∏—Å–∫ (–±–∞–∑–æ–≤—ã–π + —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ ID
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∏–Ω–¥–µ–∫—Å–∞
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ (100 —Å–æ–±—ã—Ç–∏–π)

**–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞:**
```python
def test_search(self, sample_events):
    store = VectorStore()
    store.add_events(
        sample_events['event_ids'],
        sample_events['texts'],
        sample_events['metadata']
    )
    
    results = store.search("trading decision buy", top_k=2)
    
    assert len(results) <= 2
    assert all('event_id' in r for r in results)
    assert all(0 <= r['score'] <= 1 for r in results)
```

### 3. **Build Script** (`scripts/build_vector_index.py`) - 224 —Å—Ç—Ä–æ–∫–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π –∏–∑ SQLite
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (batch)
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ FAISS –∏–Ω–¥–µ–∫—Å–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫
- –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python scripts/build_vector_index.py
python scripts/build_vector_index.py --source logs --limit 100
python scripts/build_vector_index.py --gpu --rebuild
```

### 4. **Test Script** (`scripts/test_vector_search.py`) - 251 —Å—Ç—Ä–æ–∫–∞

**–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:**
- –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
- –û–¥–∏–Ω–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å

**–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```
üîç Query: trading decision buy
üîç Query: market price | k=10 | source=logs
stats - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–Ω–¥–µ–∫—Å–∞
detail <event_id> - –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è
quit - –í—ã—Ö–æ–¥
```

### 5. **MetadataStore** (`src/layer2_storage/metadata_store.py`) - 184 —Å—Ç—Ä–æ–∫–∏

**API:**
```python
class MetadataStore:
    def insert_event(event: IngestedEvent)
    def bulk_insert_events(events: List[IngestedEvent])
    def get_event(event_id: str)
    def search_metadata(source, min_authority, freshness_hours, limit)
    def count_events(source)
```

### 6. **Data Models** (`src/layer1_ingestion/models.py`) - 96 —Å—Ç—Ä–æ–∫

**–ú–æ–¥–µ–ª–∏:**
- `IngestMessage` - –°—ã—Ä–æ–π –≤–≤–æ–¥ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- `IngestedEvent` - –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
- `EIAStorageData` - –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ EIA
- `WeatherForecast` - –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã
- `NewsItem` - –ù–æ–≤–æ—Å—Ç–Ω–∞—è —Å—Ç–∞—Ç—å—è

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```
Core:
- pydantic==2.9.2
- pydantic-settings==2.6.1
- python-dotenv==1.0.1

Data Processing:
- pandas==2.2.3
- numpy>=1.26.0

Vector Store:
- faiss-cpu==1.9.0.post1
- sentence-transformers==3.3.1

Metadata Store:
- sqlalchemy==2.0.36

LLM:
- openai==1.58.1

Testing:
- pytest==8.3.4
- pytest-asyncio==0.25.2
- pytest-cov==6.0.0
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`src/config.py`):
```python
class Settings(BaseSettings):
    # API Keys
    openrouter_api_key: str
    eia_api_key: str
    weather_api_key: str
    
    # Paths
    raw_data_path: Path = "./data/raw"
    vector_index_path: Path = "./data/vector_index"
    sqlite_db_path: Path = "./data/metadata.db"
    
    # Embedding
    embedding_model: str = "sentence-transformers/all-MiniLM-L6-v2"
    
    # LLM
    openrouter_model: str = "anthropic/claude-3.5-sonnet"
```

---

## üìä –î–∞–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ

### –¢–æ—Ä–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–∑ –ª–æ–≥–æ–≤ –±–æ—Ç–∞):

**–°–µ—Å—Å–∏—è 2026-01-30:**
- 664 —Å–æ–±—ã—Ç–∏—è (—Ü–∏–∫–ª—ã —Ä–µ—à–µ–Ω–∏–π)
- 7 —Å–¥–µ–ª–æ–∫
- –ü–µ—Ä–∏–æ–¥: 11:18:55 ‚Üí 23:49:18
- –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: 0 –ª–æ—Ç–æ–≤
- P&L: 0.0%

**–°–µ—Å—Å–∏—è 2026-01-29:**
- 377 —Å–æ–±—ã—Ç–∏–π
- 19 —Å–¥–µ–ª–æ–∫
- –ü–µ—Ä–∏–æ–¥: 16:32:28 ‚Üí 23:49:26
- –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: 0 –ª–æ—Ç–æ–≤
- P&L: 0.0%

**–ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ 0 NULL actions
- ‚úÖ 0 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ event_ids
- ‚úÖ 0 orphaned trades

### RAG —Å–æ–±—ã—Ç–∏—è:
- ‚ùå –ü–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (—Ç–∞–±–ª–∏—Ü–∞ `events` –ø—É—Å—Ç–∞)
- –¢—Ä–µ–±—É–µ—Ç—Å—è: –ó–∞–ø—É—Å—Ç–∏—Ç—å ingestion pipeline –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –≤—á–µ—Ä–∞ (2026-02-04)

–°—É–¥—è –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∫–æ–¥—É, –≤—á–µ—Ä–∞ –±—ã–ª–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è —Ä–∞–±–æ—Ç–∞:

### 1. **–°–æ–∑–¥–∞–Ω–∏–µ Vector Store —Å–∏—Å—Ç–µ–º—ã** ‚úÖ
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–ª–∞—Å—Å `VectorStore` —Å –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è FAISS –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞

### 2. **–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤** ‚úÖ
- –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ unit-—Ç–µ—Å—Ç–∞–º–∏ (263 —Å—Ç—Ä–æ–∫–∏)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è edge cases
- –¢–µ—Å—Ç—ã batch –æ–ø–µ—Ä–∞—Ü–∏–π

### 3. **–°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç** ‚úÖ
- –°–∫—Ä–∏–ø—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ (`build_vector_index.py`)
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç (`test_vector_search.py`)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`check_database.py`)

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** ‚úÖ
- –î–µ—Ç–∞–ª—å–Ω—ã–π README.md (357 —Å—Ç—Ä–æ–∫)
- –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- Roadmap –ø—Ä–æ–µ–∫—Ç–∞

### 5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã** ‚úÖ
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic Settings
- –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (271 —Å—Ç—Ä–æ–∫–∞ SQL)
- Requirements.txt —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- .env.example –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:

1. **–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å** üî¥
   ```bash
   python scripts/build_vector_index.py
   ```
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –∏–∑ `trading_events` –≤ `events`
   - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
   - –ü–æ—Å—Ç—Ä–æ–∏—Ç—å FAISS –∏–Ω–¥–µ–∫—Å

2. **–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** üü°
   - EIA storage reports (PDF)
   - Weather data (API)
   - News articles (TXT/MD)

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫** üü°
   ```bash
   python scripts/test_vector_search.py --interactive
   ```

### –§–∞–∑–∞ 2 (Retrieval):

4. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å BM25 –ø–æ–∏—Å–∫** üü°
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQLite FTS5
   - Keyword-based retrieval

5. **Hybrid Search** üü°
   - –û–±—ä–µ–¥–∏–Ω–∏—Ç—å BM25 + dense embeddings
   - Reciprocal Rank Fusion (RRF)

6. **Reranking** üü°
   - Cross-encoder –º–æ–¥–µ–ª—å
   - –£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ç–æ–ø-K —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

7. **Evaluation** üü°
   - –°–æ–∑–¥–∞—Ç—å –∑–æ–ª–æ—Ç–æ–π Q/A –¥–∞—Ç–∞—Å–µ—Ç
   - –ú–µ—Ç—Ä–∏–∫–∏: Precision@K, Recall@K, MRR
   - Ragas-like –æ—Ü–µ–Ω–∫–∞

### –§–∞–∑–∞ 3 (Generation):

8. **LLM Integration** ‚è≥
   - OpenRouter API –∫–ª–∏–µ–Ω—Ç
   - Prompt templates
   - Citation tracking

9. **RAG Pipeline** ‚è≥
   - Query ‚Üí Retrieve ‚Üí Generate
   - Context compression
   - Anti-injection guards

---

## üí° –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ best practices

### 1. **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ID**
- Event ID = MD5(source + timestamp + canonical_form)
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è

### 2. **–°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ú–æ–¥—É–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### 3. **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è**
- `authority` (0-1): –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- `freshness`: –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- `data_period`: –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö

### 4. **–ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**
- SQLite: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, FTS5 –¥–ª—è keyword search
- FAISS: –≤–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –õ—É—á—à–µ–µ –∏–∑ –æ–±–æ–∏—Ö –º–∏—Ä–æ–≤

### 5. **Production-ready –∫–æ–¥**
- Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Type hints
- Docstrings

### 6. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**
- Unit —Ç–µ—Å—Ç—ã
- Fixtures –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

### –ö–æ–¥:
- **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ Python**: 13
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~2,500+
- **–°—Ç—Ä–æ–∫ —Ç–µ—Å—Ç–æ–≤**: 263
- **–°—Ç—Ä–æ–∫ SQL**: 271
- **–°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: 357 (README)

### –î–∞–Ω–Ω—ã–µ:
- **–°–æ–±—ã—Ç–∏—è –≤ –ë–î**: 1,041
- **–°–µ—Å—Å–∏–∏**: 2
- **–°–¥–µ–ª–∫–∏**: 26
- **–í–µ–∫—Ç–æ—Ä—ã**: 0 (–∏–Ω–¥–µ–∫—Å –Ω–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω)

### –ü–æ–∫—Ä—ã—Ç–∏–µ:
- **Layer 1 (Ingestion)**: ‚úÖ 100%
- **Layer 2 (Storage)**: ‚úÖ 100%
- **Layer 3 (Retrieval)**: üöß 30%
- **Layer 4 (Generation)**: ‚è≥ 0%
- **Layer 5 (Agents)**: ‚è≥ 0%

---

## üéì –í—ã–≤–æ–¥—ã

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ:
1. ‚úÖ –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–µ–≤
2. ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥ —Å —Ç–µ—Å—Ç–∞–º–∏
4. ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
5. ‚úÖ Production-ready –ø–æ–¥—Ö–æ–¥

### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:
1. üî¥ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω
2. üü° RAG —Å–æ–±—ã—Ç–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
3. üü° Hybrid search –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
4. üü° Evaluation pipeline –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
5. üü° LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø–ª–∞–Ω–∞—Ö

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** - EIA, weather, news
3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å hybrid search** - –∫–ª—é—á–µ–≤–∞—è —Ñ–∏—á–∞ RAG
4. **–°–æ–∑–¥–∞—Ç—å eval dataset** - –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
5. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å LLM** - –∑–∞–≤–µ—Ä—à–∏—Ç—å RAG pipeline

---

## üìö –†–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `README.md` - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `src/layer2_storage/schema.sql` - –°—Ö–µ–º–∞ –ë–î
- `tests/unit/test_vector_store.py` - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–∫—Ä–∏–ø—Ç—ã:
- `scripts/build_vector_index.py` - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
- `scripts/test_vector_search.py` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞
- `scripts/check_database.py` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
- `scripts/ingest_trading_logs.py` - –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- `.env.example` - –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `requirements.txt` - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
- `pyproject.toml` - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞**: 2026-02-06  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: Phase 1 Complete, Phase 2 In Progress  
**–ê–≤—Ç–æ—Ä**: –†—É—Å–ª–∞–Ω –õ–∞—Ç—ã–ø–æ–≤ (russo2100)
